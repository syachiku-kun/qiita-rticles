---
title: 【3/5】GitLab+GitLab Runner を構築する道のり
tags:
  - Git
  - PowerShell
  - GitLab
  - Hyper-V
  - CICD
private: false
updated_at: '2025-12-31T02:36:41+09:00'
id: cbfb3029ee5c046eb134
organization_url_name: null
slide: false
ignorePublish: false
---

# 1. 概要

ひとつ前の記事では、いくつかの仮想マシンと外部からの疎通確認を行いました。
ここでは、仮想マシンに GitLab と GitLab Runner を導入していきます。
やっとスタートと言えますね。

# 2. ロードマップ

- 1 全体的な説明

https://qiita.com/cipher-31186/items/1e4add84ae5be69ee782

- 2 仮想マシンを構築

https://qiita.com/cipher-31186/items/023019f06e041fcfe907

- 3 GitLab の導入と GitLab Runner の導入 <font color="red">**★ 今ここ**</font>

https://qiita.com/cipher-31186/items/cbfb3029ee5c046eb134

- 4 GitLab Runner 設定

https://qiita.com/cipher-31186/items/d803e3a73b1ec7aeefea

- 5 テストラン

https://qiita.com/cipher-31186/items/634f35c1bb9e9399e6b2

# 3. アプリ導入

- **機能要件(取り消し線は済)**

- ~~Hyper-V で構築された仮想マシンが 3 つ必要~~
- ~~OS は Linux が 2 つ、Windows が 1 つ~~
  - Linux の GitLab 用仮想マシンには Docker をインストールし、Docker コンテナに GitLab をインストールする
  - Linux の GitLab Runner 用仮想マシンには Docker をインストールし、Docker コンテナに GitLab Runner をインストールする(用途ごとにコンテナは分ける)
  - Windows の GitLab Runner 用仮想マシンには、Windows コンテナに GitLab Runner をインストールする(用途ごとにコンテナは分ける)
- CI/CD によって、前準備＆ビルドが可能

## 3.1. `Ubuntu Desktop 24.04.3(GitLab)`仮想マシンに GitLab を導入(192.168.0.177)

- ここでは、Docker と[GitLab EE](https://hub.docker.com/r/gitlab/gitlab-ee)の導入をします。

### 3.1.1. Ubuntu に Docker と Docker Compose をインストール

1. 事前確認として、**現段階のパッケージリストをチェック**します。

    - (正直するかは好みですが)自分はエラーの原因調査とかの手がかりとして残すことが多いです。
    - `192.168.0.177_apt_list_before.txt`は[こちら](**後で追加**)にあるので、気が向いたかたはどうぞ(そんなもの好きはいないと思いますが笑)。思った以上に多いですね。

    ```
    gitlab@gitlab:~$ sudo apt list > 192.168.0.177_apt_list_before.txt

    WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

    gitlab@gitlab:~$
    ```

2. [こちら](https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository)の手順に沿って、Docker の apt リポジトリを登録します。

    - curl の[-fsSL オプションについてはこちら](https://qiita.com/keitean/items/52190516774d72b79ae8)

    ```
    # aptリポジトリの更新
    sudo apt update
    # aptリポジトリからライブラリをインストールする
    # gitlab@gitlab:~$ apt-cache search ca-certificates
    # ca-certificates - 一般的な CA の証明書
    # gitlab@gitlab:~$ apt-cache search curl
    # curl - URL 文法でデータを転送するコマンドラインツール
    sudo apt install ca-certificates curl
    # installコマンドでディレクトリ作成と同時に権限設定
    sudo install -m 0755 -d /etc/apt/keyrings
    # curlでGPG公開鍵をダウンロード
    sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
    # 出力された鍵に権限設定
    sudo chmod a+r /etc/apt/keyrings/docker.asc

    # aptリポジトリの情報を追記
    sudo tee /etc/apt/sources.list.d/docker.sources <<EOF
    Types: deb
    URIs: https://download.docker.com/linux/ubuntu
    Suites: $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}")
    Components: stable
    Signed-By: /etc/apt/keyrings/docker.asc
    EOF

    # aptリポジトリの更新
    sudo apt update
    # Dockerのライブラリをインストール
    sudo apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

    # Docker Composeの動作確認
    docker compose version
    ```

    <details><summary>標準出力を含めた上記コマンド実行結果</summary>

    ```shell
    gitlab@gitlab:~$ sudo apt update
    ヒット:1 http://archive.ubuntu.com/ubuntu noble InRelease
    ヒット:2 http://archive.ubuntu.com/ubuntu noble-updates InRelease
    ヒット:3 http://security.ubuntu.com/ubuntu noble-security InRelease
    ヒット:4 http://archive.ubuntu.com/ubuntu noble-backports InRelease
    パッケージリストを読み込んでいます... 完了
    依存関係ツリーを作成しています... 完了
    状態情報を読み取っています... 完了
    アップグレードできるパッケージが 151 個あります。表示するには 'apt list --upgradable' を実行してください。
    gitlab@gitlab:~$ sudo apt install ca-certificates curl
    パッケージリストを読み込んでいます... 完了
    依存関係ツリーを作成しています... 完了
    状態情報を読み取っています... 完了
    ca-certificates はすでに最新バージョン (20240203) です。
    ca-certificates は手動でインストールしたと設定されました。
    以下のパッケージが新たにインストールされます:
      curl
    アップグレード: 0 個、新規インストール: 1 個、削除: 0 個、保留: 151 個。
    226 kB のアーカイブを取得する必要があります。
    この操作後に追加で 534 kB のディスク容量が消費されます。
    続行しますか? [Y/n] Y
    取得:1 http://archive.ubuntu.com/ubuntu noble-updates/main amd64 curl amd64 8.5.0-2ubuntu10.6 [226 kB]
    226 kB を 2秒 で取得しました (136 kB/s)
    以前に未選択のパッケージ curl を選択しています。
    (データベースを読み込んでいます ... 現在 150459 個のファイルとディレクトリがインストールされています。)
    .../curl_8.5.0-2ubuntu10.6_amd64.deb を展開する準備をしています ...
    curl (8.5.0-2ubuntu10.6) を展開しています...
    curl (8.5.0-2ubuntu10.6) を設定しています ...
    man-db (2.12.0-4build2) のトリガを処理しています ...
    gitlab@gitlab:~$ sudo install -m 0755 -d /etc/apt/keyrings
    gitlab@gitlab:~$ sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
    gitlab@gitlab:~$ sudo chmod a+r /etc/apt/keyrings/docker.asc
    gitlab@gitlab:~$ sudo tee /etc/apt/sources.list.d/docker.sources <<EOF
    Types: deb
    URIs: https://download.docker.com/linux/ubuntu
    Suites: $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}")
    Components: stable
    Signed-By: /etc/apt/keyrings/docker.asc
    EOF
    Types: deb
    URIs: https://download.docker.com/linux/ubuntu
    Suites: noble
    Components: stable
    Signed-By: /etc/apt/keyrings/docker.asc
    gitlab@gitlab:~$ sudo apt update
    取得:1 https://download.docker.com/linux/ubuntu noble InRelease [48.5 kB]
    取得:2 https://download.docker.com/linux/ubuntu noble/stable amd64 Packages [41.1 kB]
    ヒット:3 http://security.ubuntu.com/ubuntu noble-security InRelease
    ヒット:4 http://archive.ubuntu.com/ubuntu noble InRelease
    ヒット:5 http://archive.ubuntu.com/ubuntu noble-updates InRelease
    ヒット:6 http://archive.ubuntu.com/ubuntu noble-backports InRelease
    89.6 kB を 1秒 で取得しました (79.8 kB/s)
    パッケージリストを読み込んでいます... 完了
    依存関係ツリーを作成しています... 完了
    状態情報を読み取っています... 完了
    アップグレードできるパッケージが 151 個あります。表示するには 'apt list --upgradable' を実行してください。
    gitlab@gitlab:~$ sudo apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
    パッケージリストを読み込んでいます... 完了
    依存関係ツリーを作成しています... 完了
    状態情報を読み取っています... 完了
    以下の追加パッケージがインストールされます:
      docker-ce-rootless-extras git git-man liberror-perl libslirp0 pigz slirp4netns
    提案パッケージ:
      cgroupfs-mount | cgroup-lite docker-model-plugin git-daemon-run | git-daemon-sysvinit git-doc git-email git-gui gitk gitweb git-cvs git-mediawiki git-svn
    以下のパッケージが新たにインストールされます:
      containerd.io docker-buildx-plugin docker-ce docker-ce-cli docker-ce-rootless-extras docker-compose-plugin git git-man liberror-perl libslirp0 pigz slirp4netns
    アップグレード: 0 個、新規インストール: 12 個、削除: 0 個、保留: 151 個。
    96.1 MB のアーカイブを取得する必要があります。
    この操作後に追加で 388 MB のディスク容量が消費されます。
    続行しますか? [Y/n] Y
    取得:1 https://download.docker.com/linux/ubuntu noble/stable amd64 containerd.io amd64 2.2.1-1~ubuntu.24.04~noble [23.4 MB]
    取得:2 http://archive.ubuntu.com/ubuntu noble/universe amd64 pigz amd64 2.8-1 [65.6 kB]
    取得:3 http://archive.ubuntu.com/ubuntu noble/main amd64 liberror-perl all 0.17029-2 [25.6 kB]
    取得:4 http://archive.ubuntu.com/ubuntu noble-updates/main amd64 git-man all 1:2.43.0-1ubuntu7.3 [1,100 kB]
    取得:5 https://download.docker.com/linux/ubuntu noble/stable amd64 docker-ce-cli amd64 5:29.1.3-1~ubuntu.24.04~noble [16.3 MB]
    取得:6 http://archive.ubuntu.com/ubuntu noble-updates/main amd64 git amd64 1:2.43.0-1ubuntu7.3 [3,680 kB]
    取得:7 http://archive.ubuntu.com/ubuntu noble/main amd64 libslirp0 amd64 4.7.0-1ubuntu3 [63.8 kB]
    取得:8 http://archive.ubuntu.com/ubuntu noble/universe amd64 slirp4netns amd64 1.2.1-1build2 [34.9 kB]
    取得:9 https://download.docker.com/linux/ubuntu noble/stable amd64 docker-ce amd64 5:29.1.3-1~ubuntu.24.04~noble [21.0 MB]
    取得:10 https://download.docker.com/linux/ubuntu noble/stable amd64 docker-buildx-plugin amd64 0.30.1-1~ubuntu.24.04~noble [16.4 MB]
    取得:11 https://download.docker.com/linux/ubuntu noble/stable amd64 docker-ce-rootless-extras amd64 5:29.1.3-1~ubuntu.24.04~noble [6,383 kB]
    取得:12 https://download.docker.com/linux/ubuntu noble/stable amd64 docker-compose-plugin amd64 5.0.0-1~ubuntu.24.04~noble [7,709 kB]
    96.1 MB を 8秒 で取得しました (11.5 MB/s)
    以前に未選択のパッケージ containerd.io を選択しています。
    (データベースを読み込んでいます ... 現在 150466 個のファイルとディレクトリがインストールされています。)
    .../00-containerd.io_2.2.1-1~ubuntu.24.04~noble_amd64.deb を展開する準備をしています ...
    containerd.io (2.2.1-1~ubuntu.24.04~noble) を展開しています...
    以前に未選択のパッケージ docker-ce-cli を選択しています。
    .../01-docker-ce-cli_5%3a29.1.3-1~ubuntu.24.04~noble_amd64.deb を展開する準備をしています ...
    docker-ce-cli (5:29.1.3-1~ubuntu.24.04~noble) を展開しています...
    以前に未選択のパッケージ docker-ce を選択しています。
    .../02-docker-ce_5%3a29.1.3-1~ubuntu.24.04~noble_amd64.deb を展開する準備をしています ...
    docker-ce (5:29.1.3-1~ubuntu.24.04~noble) を展開しています...
    以前に未選択のパッケージ pigz を選択しています。
    .../03-pigz_2.8-1_amd64.deb を展開する準備をしています ...
    pigz (2.8-1) を展開しています...
    以前に未選択のパッケージ docker-buildx-plugin を選択しています。
    .../04-docker-buildx-plugin_0.30.1-1~ubuntu.24.04~noble_amd64.deb を展開する準備をしています ...
    docker-buildx-plugin (0.30.1-1~ubuntu.24.04~noble) を展開しています...
    以前に未選択のパッケージ docker-ce-rootless-extras を選択しています。
    .../05-docker-ce-rootless-extras_5%3a29.1.3-1~ubuntu.24.04~noble_amd64.deb を展開する準備をしています ...
    docker-ce-rootless-extras (5:29.1.3-1~ubuntu.24.04~noble) を展開しています...
    以前に未選択のパッケージ docker-compose-plugin を選択しています。
    .../06-docker-compose-plugin_5.0.0-1~ubuntu.24.04~noble_amd64.deb を展開する準備をしています ...
    docker-compose-plugin (5.0.0-1~ubuntu.24.04~noble) を展開しています...
    以前に未選択のパッケージ liberror-perl を選択しています。
    .../07-liberror-perl_0.17029-2_all.deb を展開する準備をしています ...
    liberror-perl (0.17029-2) を展開しています...
    以前に未選択のパッケージ git-man を選択しています。
    .../08-git-man_1%3a2.43.0-1ubuntu7.3_all.deb を展開する準備をしています ...
    git-man (1:2.43.0-1ubuntu7.3) を展開しています...
    以前に未選択のパッケージ git を選択しています。
    .../09-git_1%3a2.43.0-1ubuntu7.3_amd64.deb を展開する準備をしています ...
    git (1:2.43.0-1ubuntu7.3) を展開しています...
    以前に未選択のパッケージ libslirp0:amd64 を選択しています。
    .../10-libslirp0_4.7.0-1ubuntu3_amd64.deb を展開する準備をしています ...
    libslirp0:amd64 (4.7.0-1ubuntu3) を展開しています...
    以前に未選択のパッケージ slirp4netns を選択しています。
    .../11-slirp4netns_1.2.1-1build2_amd64.deb を展開する準備をしています ...
    slirp4netns (1.2.1-1build2) を展開しています...
    liberror-perl (0.17029-2) を設定しています ...
    docker-buildx-plugin (0.30.1-1~ubuntu.24.04~noble) を設定しています ...
    containerd.io (2.2.1-1~ubuntu.24.04~noble) を設定しています ...
    Created symlink /etc/systemd/system/multi-user.target.wants/containerd.service → /usr/lib/systemd/system/containerd.service.
    docker-compose-plugin (5.0.0-1~ubuntu.24.04~noble) を設定しています ...
    docker-ce-cli (5:29.1.3-1~ubuntu.24.04~noble) を設定しています ...
    libslirp0:amd64 (4.7.0-1ubuntu3) を設定しています ...
    pigz (2.8-1) を設定しています ...
    git-man (1:2.43.0-1ubuntu7.3) を設定しています ...
    docker-ce-rootless-extras (5:29.1.3-1~ubuntu.24.04~noble) を設定しています ...
    slirp4netns (1.2.1-1build2) を設定しています ...
    docker-ce (5:29.1.3-1~ubuntu.24.04~noble) を設定しています ...
    Created symlink /etc/systemd/system/multi-user.target.wants/docker.service → /usr/lib/systemd/system/docker.service.
    Created symlink /etc/systemd/system/sockets.target.wants/docker.socket → /usr/lib/systemd/system/docker.socket.
    git (1:2.43.0-1ubuntu7.3) を設定しています ...
    man-db (2.12.0-4build2) のトリガを処理しています ...
    libc-bin (2.39-0ubuntu8.6) のトリガを処理しています ...
    gitlab@gitlab:~$ docker compose version
    Docker Compose version v5.0.0
    gitlab@gitlab:~$
    ```

    </details>

3. **インストール後のパッケージリストをチェック**します。

    - インストール前があるならば、インストール後も記録しておきます。これも好みです。
    - `192.168.0.177_apt_list_after.txt`は[こちら](**後で追加**)にあります。

    ```
    gitlab@gitlab:~$ sudo apt list > 192.168.0.177_apt_list_after.txt

    WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

    gitlab@gitlab:~$
    ```

### 3.1.2. `docker-compose.yml`の記載とコンテナ構築

### 3.1.3. GitLab へログイン

## 3.2. `Ubuntu Desktop 24.04.3(GitLab Runner on Linux)`仮想マシンに GitLab Runner を Linux で導入(192.168.0.178)

- [GitLab Runner](https://hub.docker.com/r/gitlab/gitlab-runner)を Docker コンテナで構築。

### 3.2.1. Ubuntu に Docker と Docker Compose をインストール

[3.1.1. Ubuntu に Docker と Docker Compose をインストール](#311-ubuntu-に-docker-と-docker-compose-をインストール)と同手順です

### 3.2.2. `docker-compose.yml`の記載とコンテナ構築

## 3.3. `Windows Server 2019(GitLab Runner on Windows)`仮想マシンに GitLab Runner を Windows で導入(192.168.0.179)

- [GitLab Runner](https://gitlab-docs.creationline.com/runner/install/windows.html)を Windows コンテナで構築。
- Windows コンテナって初なんですよね。

```


```
